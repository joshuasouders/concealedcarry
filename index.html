<!DOCTYPE html>
<title>Concealed Carry Laws</title>
<meta charset="utf-8"/>
<meta property="og:site_name" content="joshuasouders.com" />
<meta property="og:title" content="Concealed Carry Laws From 1986 to 2016" />
<meta property="og:description" content="Watch the progression of concealed carry rights over the past 30 years." />
<meta property="og:image" content="http://joshuasouders.com/concealedcarrymap/default-image.png" />

<head>
<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
<!--<link href="bootstrap.min.css" rel="stylesheet">-->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link href="css/bootstrap-slider.css" rel="stylesheet">
<link href="css/social-share-kit.css" rel="stylesheet">
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />

<style>
html, body{
  width:100%;
  height:100%;
  background-color:rgb(36, 36, 38);
  color:#ffffff;
}
.slider{
  width:100%!important;
}
#map{
  width:100%;
  height:100%;
  background-color:#242426;
}
.center{
  text-align:center;
  margin-top:10px;
}
h1{
  display:inline;
}

.timeLapseContainer{
  margin-left:15px;
  width:60%;
  margin-bottom:15px;
  display:inline-block;
}
.btn-animate{
  margin-left:30px;
}

.header{
  position:absolute;
  background-color: rgba(77, 77, 77,0.85);
  z-index:999999999;
  width:100%;
}

.leaflet-top.leaflet-left{
  margin-top:90px;
}

.legend {
    line-height: 18px;
    color: #555;
}
.legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
}

.info {
    padding: 6px 8px;
    font: 14px/16px Arial, Helvetica, sans-serif;
    background: white;
    background: rgba(255,255,255);
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
    color:#000000;
}
.info h4 {
    margin: 0 0 5px;
    color: #777;
}

.leaflet-popup-content{
  text-align:center;
}

.tooltip{
  opacity:1;
    position: relative;
    font:14px/16px Arial,Helvetica,sans-serif;
}



.tooltip:hover:after{
    background: #333;
    background: rgba(0,0,0,.8);
    border-radius: 5px;
    bottom: 26px;
    color: #fff;
    content: attr(title);
    left: 20%;
    padding: 5px 15px;
    position: absolute;
    z-index: 98;
    width: 220px;
}



.tooltip:hover:before{
    border: solid;
    border-color: #333 transparent;
    border-width: 6px 6px 0 6px;
    bottom: 20px;
    content: "";
    left: 50%;
    position: absolute;
    z-index: 99;
}

.tooltip-main, .tooltip-min, .tooltip-max{
  display:none;
}

#time{
  text-align:center;
}

#lastYear{
  margin-left:5px;
}

.black-text{
  color:#000000;
}

.table{
  border-collapse: none;
}

.leaflet-container .leaflet-control-attribution{
  background: rgb(255,255,255);
}

.ssk.ssk-embed{
  background-color:#34662A;
}

.ssk{
  border:none!important;
}

.modal-dialog{
  margin-top:100px;
}

@media (max-width: 624px) {
  .title{
    display:none;
  }
  .timeLapseContainer{
    width:70%;
  }
}


</style>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<script type='text/javascript' src="js/jquery.min.js"></script>
<script type='text/javascript' src="js/bootstrap.min.js"></script>
<script type='text/javascript' src="js/bootstrap-slider.js"></script>
<script type='text/javascript' src="js/social-share-kit.min.js"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

<script>
      window.fbAsyncInit = function() {
    FB.init({
      appId      : '1408971459411295',
      xfbml      : true,
      version    : 'v2.2'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));


    </script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>

</head>
<body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55017085-10', 'auto');
  ga('send', 'pageview');

</script>
<div class="header">
  <div class="center title">
    <h1>Concealed Carry Laws By State - </h1><h1 id="ex6SliderVal">1986</h1>
  </div>
    <div id="time">
      <p style="display:inline-block; font-size:20px;" id="firstYear"></p>
      <div class="timeLapseContainer">
        <input id="ex6" type="text" data-slider-min="1986" data-slider-max="2016" data-slider-step="1" data-slider-value="1986">
      </div>
      <p style="display:inline-block; font-size:20px;" id="lastYear"></p>
      <button type="button" class="btn btn-default btn-animate" id="animate">Animate</button>
      </div>
</div>
<div class="ssk-sticky ssk-center ssk-right ssk-sm">
        <button id="facebook" class="ssk ssk-facebook"></button>
        <a id="twitter" class="ssk ssk-twitter"
          href="https://twitter.com/share?
          url=https%3A%2F%2Fdev.twitter.com%2Fweb%2Ftweet-button&
          via=twitterdev&
          related=twitterapi%2Ctwitter&
          hashtags=example%2Cdemo&
          text=custom%20share%20text" target="_blank">
        </a>
        <a id="googlePlus" class="ssk ssk-google-plus" href="https://plus.google.com/share?url=http://joshuasouders.com/concealedcarrymap/" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"></a>
        <a id="email" class="ssk ssk-email" href="mailto:?subject=Concealed carry rights, from 1984 to 2016&amp;body=Check out this site: http://joshuasouders.com/concealedcarrymap. It has a really cool map that shows how the concealed carry laws have changed over time."
        title="Share by Email"></a>
        <a id="embed" href="#embedmodal" class="ssk ssk-embed" data-toggle="modal" data-target="#embedmodal"><span class="glyphicon glyphicon-export"></span></a>

    </div>
            <!--<iframe src="http://commonlyowned.org/concealedcarry" width="1000" height="600"></iframe>-->
<div class="modal fade" id="embedmodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title black-text" id="myModalLabel">Embed Code</h4>
      </div>
      <div class="modal-body">
        <code>
          &lt;iframe src="http://joshuasouders.com/concealedcarrymap" width="1000" height="600"&gt;&lt;/iframe&gt;
        </code>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div id="map"></div>

<script>
    var slider = new Slider("#ex6");

    SocialShareKit.init({
      selector: '.custom-parent .ssk',
      url: 'http://my-url',
      text: 'Share text default'
    });

    slider.on("slideStop", function(slideEvt) {
      if(animating == true){
        clearInterval(interval);
      }
    });

    slider.on("change", function(slideEvt) {
      $("#ex6SliderVal").text(slideEvt.value.newValue);
      updateData(slideEvt.value.newValue);
    });

    document.getElementById("firstYear").innerHTML = document.getElementById("ex6").attributes['data-slider-min'].value;
    document.getElementById("lastYear").innerHTML = document.getElementById("ex6").attributes['data-slider-max'].value;

    var map = L.map('map', {minZoom: 3, maxZoom: 7}).setView([40, -96], 5).setMaxBounds([[-21.82100, -280.48568], [80.49581, 23.60807]]).fitBounds([[22.73674, -127.85614], [50.27605, -64.57489]]);

    L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}.png',{
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>, Data from <a href="http://en.wikipedia.org/wiki/File:Rtc2.gif">Wikipedia</a>, created by <a href="https://www.linkedin.com/pub/joshua-souders/31/8aa/852">Joshua Souders</a>'
    }).addTo(map);

    var animating = false;
    var layer;
    var firstYear = 1986;
    var lastYear = 2016;
    var currentYear = 1986;
    var interval;

    document.getElementById("animate").addEventListener("click", function(e){
      if(animating == false){
        animate();
      }
    }, false);

    var legend = L.control({position: 'bottomleft'});

    legend.onAdd = function (map) {

        var div = L.DomUtil.create('div', 'info legend');
        // loop through our density intervals and generate a label with a colored square for each interval
        div.innerHTML += '<div id="constitutional" title="Constitutional Carry is when the state doesn\'t require a permit to carry a concealed firearm. This is the least restrictive law." class="tooltip"><i style="background:' + getColor(3) + '"></i>&ndash; Constitutional Carry</div><br>';
        div.innerHTML += '<div id="shall" title="Shall Issue is when the state requires a permit to carry a concealed firearm, however, they must issue a permit to an applicant if he/she meets a set of objective and generally permissive criteria (he/she must be a certain age, not be a felon, etc)." class="tooltip"><i style="background:' + getColor(2) + '"></i>&ndash; Shall Issue</div><br>';
        div.innerHTML += '<div id="may" title="May Issue is when the state requires a permit to carry a concealed firearm, however, the issuance of the permit is at the discretion of the issuing authority (assuming the applicant also meets the minimum objective requirements in the state law, such as age and criminal status). Authorities in may issue states might decide that everyone is qualified for a concealed permit, or they might reject every applicant, or they might arbitrarily decide who gets a permit and who does not. Good and substantial reason [to carry a concealed firearm] is frequently a necessity for applicants, and in many states self defense is not a valid good and substantial reason which in practice means that the average citizen will never recieve a concealed carry permit. This is increasingly true in later years." class="tooltip"><i style="background:' + getColor(1) + '"></i>&ndash; May Issue</div><br>';
        div.innerHTML += '<div id="no" title="No Issue is when the state has no method to apply for a concealed carry permit and the carrying of concealed firearms is illegal. This is the most restrictive law." class="tooltip"><i style="background:' + getColor(0) + '"></i>&ndash; No Issue</div>';

        return div;
    };

    legend.addTo(map);

    function style(feature) {
        return {
            fillColor: getColor(feature.properties.years[currentYear][currentYear]),
            weight: 2,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 1
        };
    }

    $.ajax({
      dataType: "json",
      url: "data/us-states.json",
      success: function(stateBoundaries){
        $.ajax({
          dataType: "json",
          url: "data/data.json",
          success: function(data){
            for(var i = 0; i < data.length; i++){
              stateBoundaries.features[i].properties.years = {};
              for(var x = 1986; x <= 2016; x++){
                var obj = {};
                obj[(x.toString())] = data[i][x.toString()];
                stateBoundaries.features[i].properties.years[x.toString()] = obj;
              }
             // for(var x = 0; x < yearArr.length; x++){
             //   stateBoundaries.features[i].properties["years"] = yearArr[x];
            //  }
            }

            //console.log(stateBoundaries);

            layer = L.geoJson(stateBoundaries, {
              style: style,
              onEachFeature: function (feature, layer) {
                var popup;
                if(feature.properties.name != "District of Columbia"){
                  popup = '<h2><a href="http://en.wikipedia.org/wiki/Gun_laws_in_' + feature.properties.name + '">' + feature.properties.name + '</a></h2>';
                }
                else{
                  popup = '<h2><a href="http://en.wikipedia.org/wiki/Gun_laws_in_the_' + feature.properties.name + '">' + feature.properties.name + '</a></h2>';
                }

                var firstTemp = feature.properties["years"][firstYear.toString()][firstYear.toString()];
                popup += '<table class="table table-hover black-text"><tbody><tr><td>' + firstYear.toString() + " - ";
                //console.log(feature.properties.years.length);
                for(var i = 1; i < (lastYear - firstYear); i++){
                  //console.log(feature.properties["years"][(firstYear + i).toString()][(firstYear + i).toString()]);
                  if(firstTemp != feature.properties["years"][(firstYear + i).toString()][(firstYear + i).toString()]){
                    popup += (firstYear + i - 1).toString() + "</td><td>";
                    popup += numToStatus(firstTemp) + '</td></tr><tr>'

                    firstTemp = feature.properties["years"][(firstYear + i).toString()][(firstYear + i).toString()];

                    popup += '<td>' + (firstYear + i).toString() + ' - ';
                  }
                }
                if(firstTemp != feature.properties["years"][(lastYear).toString()][(lastYear).toString()]){
                  popup += (firstYear + i - 1).toString() + "</td><td>";
                  popup += numToStatus(firstTemp) + '</td></tr><tr>'

                  firstTemp = feature.properties["years"][(firstYear + i).toString()][(firstYear + i).toString()];

                  if(numToStatus(feature.properties["years"][(firstYear + i).toString()][(firstYear + i).toString()]) != numToStatus(feature.properties["years"][lastYear.toString()][lastYear.toString()])){
                    popup += '<td>' + (firstYear + i).toString() + ' - ';
                  }
                  else{
                    popup += '<td>' + (firstYear + i).toString();
                  }
                }
                if(numToStatus(feature.properties["years"][(lastYear - 1).toString()][(lastYear - 1).toString()]) === numToStatus(feature.properties["years"][lastYear.toString()][lastYear.toString()])){
                  popup += lastYear;
                }
                popup += '</td><td>' + numToStatus(feature.properties["years"][lastYear.toString()][lastYear.toString()]) + '</td></tr></tbody></table>'
                layer.bindPopup(popup);
              }
            }).addTo(map);
          }
        });
      }
    });

    document.getElementById("facebook").addEventListener("click", function(){
        FB.ui({
          method: 'share',
          href: 'http://joshuasouders.com/concealedcarrymap/',
        }, function(response){});
    });

    function getColor(value){
      if(value == 0){
        return "#d7191c";
      }
      else if(value == 1){
        return "#eb8183";
      }
      else if(value == 2){
        return "#b4ffad";
      }
      else{
        return "#11c900";
      }
    }

    function numToStatus(num){
      if(num == 0){
        return "No Issue";
      }
      else if(num == 1){
        return "May Issue";
      }
      else if(num == 2){
        return "Shall Issue";
      }
      else{
        return "Constitutional Carry";
      }
    }

    function updateData(year){
      currentYear = year;
      layer.setStyle(style);
    }

    function animate(){
      animating = true;
      var dateMin = parseInt(document.getElementById("ex6").attributes['data-slider-min'].value);
      var dateMax = parseInt(document.getElementById("ex6").attributes['data-slider-max'].value);

      var i = 0;

      interval = window.setInterval(function(){
        updateData(dateMin + i);

        slider.setValue(dateMin + i);
        $("#ex6SliderVal").text(dateMin + i);

        i++;

        if((dateMin + i) > dateMax){
          animating = false;
          clearInterval(interval);
        }
      }, 400);
    }
</script>
</body>
</html>